🧬 实习日志 第16天｜DEL/BND变异检测与VCF整理实践
**日期：2025年7月28日**
**地点：首都医科大学生信实验室，服务器终端（iTerm2）**

---

💡 **今日完成的工作：**

1. **DEL变异的精简子集比对完成**

   * 从昨日提取的 `subset_1.fq` 和 `subset_2.fq` 出发，使用 `bwa mem` 比对至病毒与宿主混合参考基因组；
   * 使用 `samtools sort` 与 `samtools index` 完成 BAM 排序与建索引，生成 `map_MN772835.1.bam` 与其 `.bai` 文件。

2. **使用 Delly 进行变异检测**

   * 执行 `delly call -g fixed_human_virus.fa -o MN772835_sv.bcf map_MN772835.1.bam` 完成变异检测；
   * 使用 `bcftools view` 转换为 VCF 格式，并压缩与建索引生成 `MN772835_sv.vcf.gz` 和 `MN772835_sv.vcf.gz.tbi`。

3. **从VCF中提取目标区域变异**

   * 通过 `bcftools view -r MN772835.1:1-8500 MN772835_sv.vcf.gz -Ov -o MN_region.vcf` 提取病毒参考区间的所有结构变异；
   * 检查 `MN_region.vcf` 内容，初步筛选无明显DEL或BND支持，文件大小约11K。

4. **目录与中间文件整理**

   * 对 VCF、BAM、索引文件按用途整理并记录文件大小与生成时间；
   * 核实所有中间文件生成成功，未出现错误中断或格式异常。

---

🔧 **技术要点回顾：**

* **Delly 变异调用流程：**
  `delly call` 能识别 INV、DEL、DUP、BND 等结构变异，输出为 BCF 格式，后续需借助 `bcftools` 进行转换与过滤。

* **结构变异筛选：**
  使用 `bcftools view -r` 可快速定位特定区域内变异，需注意参考序列名是否与 BAM/FASTA 一致。

* **索引文件同步更新：**
  对于 `.bam` 和 `.vcf.gz` 文件，分别使用 `samtools index` 和 `tabix` 构建 `.bai` 与 `.tbi` 索引，有助于后续可视化与按区域查询。

---

🧠 **今日收获：**

* 熟悉了 Delly 从 BAM 到结构变异 VCF 的完整流程；
* 掌握了通过 `bcftools view` 提取参考基因组特定区段变异的方法；
* 对 BAM/BCF/VCF 等不同格式间的依赖关系有了更清晰的认识；
* 能够规范地整理中间文件，提升整体项目文件的可读性与重现性；
* 精读了五页论文，对英文阅读有更细致的了解。

---

❗ **问题与不足：**

* 提取出的 `MN_region.vcf` 文件虽格式正确，但暂未发现具备实际研究价值的变异记录；
* 目前尚未建立明确标准用于判断支持某突变的 reads 数量或质量，影响后续的验证与展示；

---

🧠 **明日计划预告：**

* 筛选 VCF 文件中的 BND 与 INV 类突变，提取支持变异的 read ID 并与昨日流程联动；
* 编写一个一键式 Bash 脚本，集成从 BAM 提取 ID 到最终 VCF输出的流程；
* 整理我的所有流程，汇聚成一个技术文档；
* 查阅 Delly 输出格式文档，尝试精确提取断点区序列及相邻注释信息。

