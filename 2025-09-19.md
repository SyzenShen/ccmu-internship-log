# 🧬 实习日志 第34天｜mosdepth 绘图脚本调试与 PDF 导出

**日期：2025-09-19**
**地点：首都医科大学生信实验室，iTerm2 + 本地Mac**

---

💡 今日完成的工作：

**1. 定位并修复错误**

* 修复 `NameError: summary_df 未定义` —— 确保脚本开头明确读取 `summary_df` 与 `dist_df`。
* 将原有三行染色体过滤替换为兼容性更强的正则提取（兼容 `chr1`、`1`、`ChrX`，并兼容鼠类染色体编号）。

**2. 绘图问题修复**

* 解决右图“成为一根线”的根因：数据未按 `depth` 排序 / 没做累积计算；修正后曲线恢复正常。
* 为左图加入排序逻辑（1..N, X, Y）并提供平滑选项（滚动平均：`rolling(window=5, center=True)`），曲线更平滑但保留峰值信息。

**3. 导出与体验**

* 增加 `plt.savefig('figure.pdf', bbox_inches='tight', dpi=300)` 保存高质量 PDF 的说明。
* 提供最小补丁（只改染色体提取与绘图前的数据处理），保证“其他代码和功能不变”。

---

📚 总结：

* 绘图脚本现在对不同染色体标签更鲁棒，绘图顺序与平滑效果可控，PDF 导出流程清晰。
* 保持最小改动原则，便于回滚与复现。

---

❗ 待改进：

* 若需保留 `MT/MT`（线粒体）或特殊染色体，需要把正则扩展到 `m|mt`。
* 平滑窗口对边界有影响，需根据具体数据微调 `window` 大小。
* 尚未把所有中间检查写入 log 文件。

---

🎯 明日计划：

* 把修正补丁整合为可选参数（`--smooth`、`--include-mt`）并提交到 GitHub。
* 在 3 个不同样本上跑通绘图，验证顺序/颜色/导出一致性。
