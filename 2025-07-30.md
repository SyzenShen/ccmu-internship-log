🧬 **实习日志 第18天｜病毒插入序列修正与参考基因组重构**
**日期：2025年7月30日**
**地点：首都医科大学生信实验室，服务器终端（iTerm2）**

---

💡 **今日完成的工作：**

1. **发现插入区域异常空缺**

   * 在 IGV 中查看比对结果时，发现病毒插入区（chr17:40332550-40333000）有明显空白；
   * 初步判断为插入序列与替换长度不匹配，导致参考基因组错位。

2. **确认插入序列长度错误**

   * 之前使用的 `virus_insert.fa` 长度为 1455 bp；
   * 但病毒原始文献或注释中说明应使用 MN772835.1 中的 789 到 1952 区段，实际长度应为 1164 bp；
   * 多插入了 291 bp，造成下游序列位移，影响比对。

3. **修正病毒序列**

   * 下载完整的 MN772835.1 病毒参考序列；
   * 使用 `seqkit` 精确裁剪 789 到 1952 区段，保存为新的插入序列 `TTMV_insert_789-1952.fa`；
   * 检查长度确认为 1164 bp，符合预期。

4. **修改 Python 插入脚本参数**

   * 保持脚本本身不变，仅调整输入文件为新的 1164 bp 序列；
   * 插入坐标仍使用 chr17:40332557-40332584，原替换长度为 28 bp，插入后序列整体增加 1136 bp；
   * 记录新插入后结束坐标为 40333720。

5. **重新生成参考基因组并建索引**

   * 运行插入脚本得到新的参考基因组 `GRCh38_TTMV_inserted_corrected.fa`；
   * 重新使用 `bwa index` 和 `samtools faidx` 建立索引，准备后续比对。

---

🔧 **关键操作说明：**

* `seqkit subseq -r 789:1952 MN772835.1.fa`：提取病毒基因组中正确的目标片段；
* 插入脚本无 bug，关键在于输入序列是否正确匹配插入区域；
* 插入后参考基因组需重新索引，保证与后续 BAM 文件对应。

---

🧠 **今日收获：**

* 理解了“插入序列长度与替换长度不一致”会直接导致参考坐标错乱的问题；
* 掌握了如何定位并提取 GenBank 数据中指定区段；
* 熟悉了用 IGV 验证比对效果时需要特别关注插入上下游区域是否对齐；
* 学会了如何通过逻辑推算和比对文件定位问题来源；
* 阅读了几页论文，内容关于实验要解决的问题。

---

❗ **问题与不足：**

* 最初没有严格核对插入序列的起止坐标，导致浪费时间调试；
* IGV 使用过程中仍对 BAM 与参考序列关系理解不够深入，需要继续学习；
* 尚未测试修正后参考基因组的比对效果，需明日继续完成。

---

📌 **明日计划预告：**

* 使用修正后参考基因组重新比对；
* 导入 BAM 文件至 IGV 检查插入区是否正常显示；
* 如果显示正确，重新进行结构变异分析与 VCF 文件提取；
* 尝试将 BAM → 结构变异 → 断点验证过程写成简单流程脚本。
