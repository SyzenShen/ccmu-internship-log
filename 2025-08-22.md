🧬 **实习日志 第27天｜组装结果检查 + IGV验证 + BLAST准备**
**日期：2025年8月22日（周五）**
**地点：首都医科大学生信实验室，iTerm2 + IGV**

---

💡 **今日完成的工作：**

**1. 组装结果检查与映射验证**

* 重新检查了 `contigs.fasta` 的长度分布，确认主要 contig 的长度和覆盖情况；
* 用 `bwa mem` 将 contig 映射回参考基因组，生成新的 `contigs_retry2.bam` 文件；
* 在 Linux 下用 `samtools flagstat` 和 `idxstats` 查看基本统计，确认有 reads 成功比对到 `chr17`。

**2. IGV 可视化验证**

* 在 IGV 里同时加载原始 realign 后的 BAM 文件和 contig 映射结果；
* 观察到 contig 确实对齐到了目标区域，虽然覆盖度不高，但说明组装出的序列能对应到 chr17 上，基本验证了组装是成功的；
* 发现和原始 reads 的覆盖情况对比时，contig 映射比较稀疏，这提示组装结果需要结合更多数据或做进一步优化。

**3. BLAST 准备**

* 制定了将 contigs/junction 序列跑 BLASTN 的计划，输出 `.tsv` 结果再转为 `.bed` 文件，以便在 IGV 中进一步验证；
* 学习了 BLAST 输出和 BED 格式的转换规则，打通了从序列比对到可视化的一条完整思路。

---

📚 **今日收获：**

* 通过 Linux 下的 `samtools` 和 IGV 的直观展示，完成了对组装结果的初步验证，增强了自己对“组装—比对—可视化”这一流程的理解；
* 学会了如何从 BLAST 结果生成 BED 文件，这为后续的功能验证和跨数据库对照提供了工具；
* 认识到实际验证不仅要看统计数字，更要结合 IGV 等可视化工具去直观比对。

---

❗ **不足与反思：**

* contig 数量和覆盖度偏低，说明组装的片段有限，后续可能需要优化组装参数或使用更高质量的数据；
* 对 BLAST 数据库的使用还不够熟悉，尤其是本地 nt 数据库的管理与更新，需要花时间去掌握；
* IGV 的可视化能直观说明问题，但定量分析不足，后面还需要在 Linux 下做更严格的统计。

---

📝 **周总结（第4周）：**

* 本周主要进展是逐步完成了从原始 reads 到组装、比对、再到 IGV 验证的一整套流程，建立了对整个实验逻辑的清晰认识；
* 掌握了 Linux 下常用的验证方法（flagstat、idxstats、depth）和可视化手段（IGV），也开始尝试将 BLAST 引入验证环节；
* 自身不足在于对底层算法的理解还比较浅，比如为什么某些 contig 映射稀疏、组装失败的潜在原因，需要更多文献学习；
* 下周重点：

  * 完成 BLASTN → BED → IGV 的验证链路；
  * 进一步思考如何优化组装，提升 contig 数量和覆盖度；
  * 开始总结这段流程，形成一个可复用的 SOP 文档。

 ---
 
 **今日使用的代码片段**
 
# 1) 查看 contig 长度分布（列出前 20 条最长）
awk '/^>/{if(seq){print id, length(seq)}; id=$0; seq=""; next}{seq=seq $0}END{if(seq)print id, length(seq)}' \
  /public/home/shenyz/genome/spades_region_out_retry2/contigs.fasta | sort -k2,2nr | head -n 20


# 2) 将 contigs 映射回参考基因组，生成 BAM 文件
bwa mem -t 12 modified_genome.fa /public/home/shenyz/genome/spades_region_out_retry2/contigs.fasta | \
  samtools sort -@8 -o /public/home/shenyz/genome/contigs_retry2.bam

# 3) 建立 BAM 索引
samtools index /public/home/shenyz/genome/contigs_retry2.bam


# 4) 查看 BAM 的基本统计信息
samtools flagstat /public/home/shenyz/genome/contigs_retry2.bam


# 5) 查看每条染色体的比对情况（按比对数排序）
samtools idxstats /public/home/shenyz/genome/contigs_retry2.bam | sort -k3,3nr | head -n 40


