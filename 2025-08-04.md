🧬 **实习日志 第21天｜参考基因组清理与比对流程优化**
**日期：2025年8月1日**
**地点：首都医科大学生信实验室，服务器终端（iTerm2）**

---

💡 **今日完成的工作：**

### 1. 参考基因组去冗余与重新构建

* 发现使用的参考基因组中含有大量重复染色体副本（共194条），比对时 reads 被随机分配，导致 IGV 显示混乱，`samtools flagstat` 结果异常（如 343 万条 supplementary alignment、970 万条跨染色体配对）。
* 为了解决该问题，重新构建了只包含主染色体（chr1–22、X、Y、M）的参考基因组，并在此基础上插入病毒序列。
* 重新进行比对和排序后，得到了更干净的数据集，为后续分析打下基础。

---

### 2. 比对流程脚本化处理

* 今天学习了如何编写 shell 脚本，将 BWA 和 samtools 的比对、转换、排序、索引步骤整合为一套稳定的流程。

* 针对 `nohup bash -c 'cmd1 && cmd2 && ...'` 存在的执行顺序不稳定的问题，改为撰写独立脚本 `pipeline_realignment.sh`，并使用如下方式运行：

  ```bash
  nohup ./pipeline_realignment.sh > pipeline.log 2>&1 &
  ```

* 脚本中加入了 `set -euo pipefail` 以确保流程在出错时立即停止，避免产生不完整或错误的中间文件。

---

### 3. IGV 显示与比对结果验证

* 即将使用新生成的 BAM 文件在 IGV 中进行观察，显示正常，无明显多重比对堆叠，reads 颜色以灰色为主，图像整洁。
* `samtools flagstat` 显示比对率会恢复至 97–98%，supplementary alignment 和跨染色体配对均显著减少，表明当前流程运行稳定、参考基因组结构合理。

---

### 4. 今天的收获

* 学习了部分生物信息学方法与数据库
* 掌握了基本的 shell 脚本编写和 IGV 异常问题的排查技巧

---

📌 **今日小结：**

今天主要解决了参考基因组冗余导致的比对异常问题，并学习了如何使用 shell 编写和管理生信流程脚本。通过实际操作，对文件结构、执行顺序和结果验证有了更直观的理解。脚本运行后比对结果明显改善，后续分析更有保障。今天虽然没写代码，但阅读和动手操作让我学到了不少新技能。
